import axios from "axios";

export async function GET({ request, url }) {
  try {
    const reference = url.searchParams.get("reference");

    if (!reference) {
      return new Response(
        JSON.stringify({
          success: false,
          error: "Reference is required",
        }),
        { status: 400, headers: { "Content-Type": "application/json" } }
      );
    }

    const apiKey = "DEV-lI9srMGzs3C5BYnQpOjkTjBfvHB0ITNGvToxxzBx";

    const response = await axios.get(
      "https://tripay.co.id/api-sandbox/transaction/check-status?reference=" +
        reference,
      {
        headers: { Authorization: "Bearer " + apiKey },
        validateStatus: function (status) {
          return status < 999;
        },
      }
    );

    return new Response(
      JSON.stringify({
        success: true,
        message: response.data.message,
        data: response.data.data,
      }),
      { status: 200, headers: { "Content-Type": "application/json" } }
    );
  } catch (error) {
    console.error(error);
    return new Response(
      JSON.stringify({
        success: false,
        error: error.message || "An error occurred",
      }),
      { status: 500, headers: { "Content-Type": "application/json" } }
    );
  }
}
